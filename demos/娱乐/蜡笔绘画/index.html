<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title></title>
	<style type="text/css">
		canvas {
			border:1px solid #0f0;
		}
	</style>
</head>
<body>
	<div id="canvasDiv"></div>
	<script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
	<!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
	<script type="text/javascript">
		//参考 http://www.williammalone.com/articles/create-html5-canvas-javascript-drawing-app/
		//在script中创建canvas是为了兼容ie
		(function(){
			var clickX = [],
				clickY = [],
				clickDrag = [],
				context,
				paint,
				canvasWidth = 490,
				canvasHeight = 220,
				$Canvas;
			$(function(){
				context = getCtx();
				$Canvas = $('#canvas');
				
				$Canvas.mousedown(function(e){
				  var mouseX = e.pageX - this.offsetLeft;
				  var mouseY = e.pageY - this.offsetTop;
						
				  paint = true;//开始绘图
				  addClick(mouseX, mouseY, false);
				  redraw();
				});
				
				$('#canvas').mousemove(function(e){
				  if(paint){
					addClick(e.pageX - this.offsetLeft, e.pageY - this.offsetTop, true);
					redraw();
				  }
				});
				
				$('#canvas').mouseup(function(e){
				  paint = false;
				});
			});
			
			function getCtx(){
				var canvasDiv = document.getElementById('canvasDiv');
					canvas = document.createElement('canvas');
					canvas.setAttribute('width', canvasWidth);
					canvas.setAttribute('height', canvasHeight);
					canvas.setAttribute('id', 'canvas');
					canvasDiv.appendChild(canvas);
				if(typeof G_vmlCanvasManager != 'undefined') {
					canvas = G_vmlCanvasManager.initElement(canvas);
				}
				context = canvas.getContext("2d");
				return context;
			};
			
			
			function addClick(x, y, dragging)
			{
			  clickX.push(x);
			  clickY.push(y);
			  clickDrag.push(dragging);
			}
			
			function redraw(){
			  context.clearRect(0, 0, context.canvas.width, context.canvas.height); // Clears the canvas
			  
			  context.strokeStyle = "#df4b26";
			  context.lineJoin = "round";
			  context.lineWidth = 5;
						
			  for(var i=0; i < clickX.length; i++) {		
				context.beginPath();
				if(clickDrag[i] && i){//是画一条线还是一个点
				  context.moveTo(clickX[i-1], clickY[i-1]);
				 }else{
				   context.moveTo(clickX[i]-1, clickY[i]);
				 }
				 context.lineTo(clickX[i], clickY[i]);
				 context.closePath();
				 context.stroke();
			  }
			}
		})();
		
	
	</script>
</body>
</html>